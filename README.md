# MORA

mora is an `event` database capable of streaming future events to every client subscribed to the relative `category`.
An `event` is a single piece of information stored in moradb, with some basic properties:
- `id`, unique id (string formatted as follow "{timestamp}-{fireAt}-{eventHash generated by hashing the other fields}")
- `category`, field that describe what category owns the event (string)
- `createdAt` timestamp defining when the event was created (Âµs)
- `fireAt` timestamp defining when the event should be fired
- `data`, custom data field

## How does it work?

Clients connect to the database via a connection string, subsequently a client can schedule an event:
```json
"event": {
    "createdAt": 1603140122,
    "fireAt": 1603140222,
    "category": "categoryName",
    "data": {
        "field": "value"
    }
};
```
`moradb.schedule(event);`

mora then proceeds to do the following:

1) Store the event inside a persistent database
2) Notify any temporal queue of the event, if the temporal queue has space it will queue it up. If the temporal queue is full it will pick it up via query to the database later on, unless the `fireAt` field is inside the current temporal range of the queue. In that case the temporal queue will make room for it by re-processing the last event in the queue at a later (compatible) time. This process will insure that each event is fired correctly and temporal queues are never overqueued.
3) When the `fireAt` time is `<=` current time, the event gets processed and all connected client will be notified of the event (if they are subscribed to the relevant category) by a dispatcher.

## How to contribute

### Test

run `elixirc .\test\domain\events\model\event_generator.exs` before `mix test`, tests use an event generator that has to be compiled manually (don't know how to fix it). 